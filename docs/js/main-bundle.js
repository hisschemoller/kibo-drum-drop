(()=>{var e={228:e=>{e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}},646:(e,t,n)=>{var r=n(228);e.exports=function(e){if(Array.isArray(e))return r(e)}},926:e=>{function t(e,t,n,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(o,a){var i=e.apply(n,r);function c(e){t(i,o,a,c,s,"next",e)}function s(e){t(i,o,a,c,s,"throw",e)}c(void 0)}))}}},713:e=>{e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},860:e=>{e.exports=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},206:e=>{e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},319:(e,t,n)=>{var r=n(646),o=n(860),a=n(379),i=n(206);e.exports=function(e){return r(e)||o(e)||a(e)||i()}},8:e=>{function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(n)}e.exports=t},379:(e,t,n)=>{var r=n(228);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}},757:(e,t,n)=>{e.exports=n(666)},666:e=>{var t=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,a=Object.create(o.prototype),i=new A(r||[]);return a._invoke=function(e,t,n){var r=d;return function(o,a){if(r===p)throw new Error("Generator is already running");if(r===h){if("throw"===o)throw a;return w()}for(n.method=o,n.arg=a;;){var i=n.delegate;if(i){var c=b(i,n);if(c){if(c===v)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var s=l(e,t,n);if("normal"===s.type){if(r=n.done?h:f,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r=h,n.method="throw",n.arg=s.arg)}}}(e,n,i),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d="suspendedStart",f="suspendedYield",p="executing",h="completed",v={};function m(){}function g(){}function E(){}var y={};y[a]=function(){return this};var S=Object.getPrototypeOf,O=S&&S(S(R([])));O&&O!==n&&r.call(O,a)&&(y=O);var I=E.prototype=m.prototype=Object.create(y);function _(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(o,a,i,c){var s=l(e[o],e,a);if("throw"!==s.type){var u=s.arg,d=u.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return n("throw",e,i,c)}))}c(s.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function b(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,b(e,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=l(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function R(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}return{next:w}}function w(){return{value:t,done:!0}}return g.prototype=I.constructor=E,E.constructor=g,g.displayName=s(E,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,s(e,c,"GeneratorFunction")),e.prototype=Object.create(I),e},e.awrap=function(e){return{__await:e}},_(T.prototype),T.prototype[i]=function(){return this},e.AsyncIterator=T,e.async=function(t,n,r,o,a){void 0===a&&(a=Promise);var i=new T(u(t,n,r,o),a);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},_(I),s(I,c,"Generator"),I[a]=function(){return this},I.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=R,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(D),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return c.type="throw",c.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;D(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:R(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}},t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e,t,r,o,a,i,c,s,u=n(757),l=n.n(u),d=n(926),f=n.n(d),p=n(8),h=n.n(p),v=[60,62,64,65,67,69,71,72],m=[102,103,104,105,106,107,108,109],g=new Array(127).fill(null),E=[],y=[null,null,null,null,null,null,null,null],S=0;function O(){return e}function I(t){var n=t.detail,r=n.state,o=n.action,a=n.actions;switch(o.type){case a.LOAD_AUDIOFILE:case a.RECORD_AUDIOSTREAM:b(r);break;case a.HANDLE_MIDI_MESSAGE:!function(t){var n=t.note,r=t.pads,o=n.command,a=n.index,i=n.velocity;e&&144===o&&0!==i&&r[a]&&function(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(y[n]){var a=y[n].buffer,i=E[S];S=++S%84;var c=v[n];_(c);var s=Math.pow(r,2)/Math.pow(127,2),u=e.currentTime+t;i.isPlaying=!0,i.source=e.createBufferSource(),i.source.buffer=a,i.source.connect(i.gain),i.source.start(u,o/a.sampleRate),i.gain.gain.setValueAtTime(s,u),i.source.onended=function(e){g[c]&&i.isPlaying&&_(c)},g[c]=i}}(0,a,i,r[a].startOffset)}(r);break;case a.TOGGLE_SETTINGS:!function(t){var n=t.isSettingsVisible;e||n||(e=new(window.AudioContext||window.webkitAudioContext)({sampleRate:22050}),function(){for(var t=0;t<84;t++){var n=e.createGain();n.connect(e.destination),E.push({isPlaying:!1,gain:n,source:null,timerId:null})}}(),b(t))}(r)}}function _(t){g[t]&&(g[t].isPlaying=!1,g[t].source.stop(e.currentTime),g[t].source.disconnect(),g[t]=null)}function T(){document.addEventListener(ve,I)}function b(t){var n=t.isRecording,r=t.pads,o=t.recordingIndex;r.map((function(t,r){if(t){var a=t.buffer,i=t.name,c=!y[r],s=y[r]&&y[r].name!==i;if(c||s||n&&r===o){for(var u=new ArrayBuffer(a.length),l=new DataView(u),d=0,f=u.byteLength;d<f;d++)l.setUint8(d,a.charCodeAt(d));for(var p=new Int16Array(u),h=e.createBuffer(1,p.length,e.sampleRate),v=h.getChannelData(0),m=0,g=p.length;m<g;m++)v[m]=p[m]/32768;y[r]={name:i,buffer:h},ge({type:Ee().AUDIOFILE_DECODED,index:r,numSamples:h.length})}}}))}function L(){t=document.querySelector(".dialog"),r=t.querySelector(".dialog__header .dialog__header-label"),o=t.querySelector(".dialog__body"),a=t.querySelector(".dialog__resolve"),i=t.querySelector(".dialog__reject"),a.addEventListener("click",(function(e){t.dataset.show=!1,c&&c()})),i.addEventListener("click",(function(e){t.dataset.show=!1,s&&s()}))}function D(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;t.dataset.show=!0,r.innerHTML=e,o.innerHTML=n,a.innerHTML=u,i.innerHTML=l,c=d,s=f,a.style.display=null!=u?"block":"none",i.style.display=null!=l?"block":"none"}var A=128,R=144,w=null;function x(){return new Promise((function(e,t){navigator.requestMIDIAccess?navigator.requestMIDIAccess({sysex:!1}).then((function(t){console.log("MIDI enabled."),w=t,e()}),(function(){t("MIDI access failed")})):t("No MIDI access in this browser")}))}function C(e){var t=e.detail,n=t.state,r=t.action,o=t.actions;switch(r.type){case o.SELECT_MIDI_INPUT:case o.SET_PROJECT:case o.UPDATE_MIDI_PORTS:!function(e){for(var t=w.inputs.values(),n=t.next();n&&!n.done;n=t.next())n.value.name===e.midiSelectedInput&&(n.value.onmidimessage=M)}(n)}}function M(e){switch(240&e.data[0]){case 240:break;case 176:ge(Ee().handleMIDIMessage(240&e.data[0],15&e.data[0],e.data[1],e.data[2]));break;case R:case A:ge(Ee().handleMIDIMessage(240&e.data[0],15&e.data[0],e.data[1],e.data[2]))}}function P(){for(var e=w.inputs.values(),t=w.outputs.values(),n=[],r=[],o=e.next();o&&!o.done;o=e.next())n.push(o.value.name);for(var a=t.next();a&&!a.done;a=t.next())r.push(a.value.name);ge(Ee().updateMIDIPorts(n,"input"))}function N(){w&&(document.addEventListener(ve,C),w.onstatechange=P,P())}var k="BLUETOOTH_CONNECT",U="BLUETOOTH_DISCONNECT",G="BLUETOOTH_ERROR",W="BLUETOOTH_SUCCESS",F="DELETE_BODIES",j="HANDLE_MIDI_MESSAGE",B="LOAD_AUDIOFILE",H="NEW_PROJECT",q="POPULATE",J="RECORD_AUDIOSTREAM",V="RECORD_ERASE",Z="RECORD_START",z="RELOAD_AUDIOFILE_ON_SAME_PAD",Y="RESIZE",$="SELECT_MIDI_INPUT",K="SELECT_SOUND",Q="SET_MIDI_ACCESSIBLE",X="SET_SAMPLE_START_OFFSET",ee="SET_WAVEFORM_POSITION",te="SET_WAVEFORM_ZOOM",ne="SET_PROJECT",re="TOGGLE_RECORD_ARM",oe="TOGGLE_RECORDING",ae="TOGGLE_SETTINGS",ie="UPDATE_MIDI_PORTS";const ce={AUDIOFILE_DECODED:"AUDIOFILE_DECODED",BLUETOOTH_CONNECT:k,bluetoothConnect:function(){return{type:k}},BLUETOOTH_DISCONNECT:U,bluetoothDisconnect:function(){return{type:U}},BLUETOOTH_ERROR:G,bluetoothError:function(){return{type:G}},BLUETOOTH_SUCCESS:W,bluetoothSuccess:function(){return{type:W}},DELETE_BODIES:F,deleteBodies:function(e){return{type:F,bodyIds:e}},LOAD_AUDIOFILE:B,loadAudioFile:function(e,t){return function(n,r,o){var a=r(),i=a.pads,c=a.selectedIndex,s=void 0===c?0:c,u=isNaN(t)?s:t,l=e[0],d=l.name,f=l.size,p=l.type,h=i[u]&&i[u].name===d;if(-1===p.indexOf("audio"))D("No audio file","This file wasn't recognised as an audio file.","Ok");else if(f>1e7)D("File too big","Files up to 1 MB are allowed.","Ok");else if(h)n({type:z,padIndex:u});else{var v=new FileReader;v.onload=function(e){O().decodeAudioData(e.target.result).then((function(e){for(var t=e.getChannelData(0),r=(t.buffer,new Int16Array(88200)),o=0,a=r.length;o<a;o++){var i=o<t.length?Math.max(-1,Math.min(t[o],1)):0;r[o]=i<0?32768*i:32767*i}for(var c=new Uint8Array(r.buffer),s="",l=0,f=c.byteLength;l<f;l++)s+=String.fromCharCode(c[l]);n({type:B,buffer:s,name:d,padIndex:u})}))},v.readAsArrayBuffer(l)}}},NEW_PROJECT:H,newProject:function(){return{type:H}},HANDLE_MIDI_MESSAGE:j,handleMIDIMessage:function(e,t,n,r){return function(t,o,a){var i=o(),c=(i.pads,i.visibleWidth,i.visibleHeight,v.indexOf(n));switch(e){case A:case R:if(-1!==c)return{type:j,command:e,index:c,velocity:r};break;case 160:break;case 176:switch(n){case 117:console.log("knob turn, value ",r);break;case 118:console.log("knob double click, value ",r);break;case 119:127===r&&t(a().toggleRecordArm());break;default:var s=m.indexOf(n);-1!==s&&t(127===r?a().toggleRecording(!0,s):a().recordErase(s))}}}},POPULATE:q,populate:function(){return{type:q}},RECORD_AUDIOSTREAM:J,recordAudioStream:function(e,t){return function(n,r,o){var a=r().recordingIndex;return{type:J,buffer:e,captureBufferPosition:t,name:"Recording ".concat(a)}}},RECORD_ERASE:V,recordErase:function(e){return function(t,n,r){var o=n(),a=o.isRecordArmed,i=o.pads,c=o.selectedIndex;if(a){var s=!isNaN(e)&&e>=0&&e<i.length;return{type:V,index:s?e:c}}}},RECORD_START:Z,recordStart:function(){return{type:Z}},RELOAD_AUDIOFILE_ON_SAME_PAD:z,RESIZE:Y,resize:function(e,t){return{type:Y,visibleWidth:e,visibleHeight:t}},SELECT_MIDI_INPUT:$,selectMIDIInput:function(e){return{type:$,name:e}},SELECT_SOUND:K,selectSound:function(e){return{type:K,index:e}},SET_MIDI_ACCESSIBLE:Q,setMidiAccessible:function(e){return{type:Q,value:e}},SET_PROJECT:ne,setProject:function(e){return{type:ne,state:e}},SET_SAMPLE_START_OFFSET:X,setSampleStartOffset:function(e){return{type:X,startOffset:e}},SET_WAVEFORM_POSITION:ee,setWaveformPosition:function(e){return{type:ee,firstWaveformSample:e}},SET_WAVEFORM_ZOOM:te,setWaveformZoom:function(e,t){return{type:te,firstWaveformSample:e,numWaveformSamples:t}},TOGGLE_RECORD_ARM:re,toggleRecordArm:function(){return{type:re}},TOGGLE_RECORDING:oe,toggleRecording:function(e,t){return function(n,r,o){var a=r(),i=a.isRecordArmed,c=a.pads,s=a.selectedIndex;if(i){var u=!isNaN(t)&&t>=0&&t<c.length;return{type:oe,isRecording:e,index:u?t:s}}}},TOGGLE_SETTINGS:ae,toggleSettings:function(e){return{type:ae,value:e}},UPDATE_MIDI_PORTS:ie,updateMIDIPorts:function(e,t){return{type:ie,portNames:e,portType:t}}};var se=n(319),ue=n.n(se),le=n(713),de=n.n(le);function fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(n),!0).forEach((function(t){de()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var he={captureBufferPosition:0,isCapturing:!1,isMIDIAccessible:!1,isRecordArmed:!1,isRecording:!1,isSettingsVisible:!1,midiInputs:[],midiOutputs:[],midiSelectedInput:null,note:{id:null,index:0,velocity:0},pads:[null,null,null,null,null,null,null,null],recordingIndex:-1,selectedIndex:-1},ve="STATE_CHANGE",me=void 0;function ge(e){if("function"==typeof e){var t=e(ge,ye,Ee);t&&ge(t)}else{var n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:he,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};switch(t.type){case n.AUDIOFILE_DECODED:var r=t.index,o=t.numSamples,a=e.pads;return pe(pe({},e),{},{pads:a.reduce((function(e,t,n){return[].concat(ue()(e),n===r?[pe(pe({},t),{},{numSamples:o,numWaveformSamples:t.numWaveformSamples?t.numWaveformSamples:o})]:[t])}),[])});case n.LOAD_AUDIOFILE:var i=t.buffer,c=t.name,s=t.padIndex,u=e.pads;return pe(pe({},e),{},{pads:u.reduce((function(e,t,n){return[].concat(ue()(e),n===s?[{buffer:i,name:c,numSamples:0,startOffset:0,firstWaveformSample:0,numWaveformSamples:0}]:[t])}),[]),selectedIndex:s});case n.NEW_PROJECT:var l=e.isMIDIAccessible,d=e.midiInputs,f=void 0===d?[]:d,p=e.midiOutputs,h=void 0===p?[]:p;return pe(pe({},he),{},{isMIDIAccessible:l,midiInputs:f,midiOutputs:h,pads:[null,null,null,null,null,null,null,null]});case n.HANDLE_MIDI_MESSAGE:var v=t.command,m=t.index,g=t.velocity;return pe(pe({},e),{},{note:{command:v,index:m,velocity:g},selectedIndex:m});case n.RECORD_AUDIOSTREAM:var E=t.buffer,y=t.captureBufferPosition,S=t.name,O=e.pads,I=e.recordingIndex;return pe(pe({},e),{},{captureBufferPosition:y,pads:O.reduce((function(e,t,n){return[].concat(ue()(e),n===I?[pe(pe({},t),{},{buffer:E,name:S,numSamples:0,startOffset:0,firstWaveformSample:0,numWaveformSamples:0})]:[t])}),[])});case n.RECORD_ERASE:var _=t.index,T=e.pads;return pe(pe({},e),{},{selectedIndex:_,pads:T.reduce((function(e,t,n){return[].concat(ue()(e),n===_?[null]:[t])}),[])});case n.RECORD_START:return pe(pe({},e),{},{isCapturing:!0});case n.RELOAD_AUDIOFILE_ON_SAME_PAD:var b=t.padIndex,L=e.pads;return pe(pe({},e),{},{pads:L.reduce((function(e,t,n){return[].concat(ue()(e),n===b?[pe(pe({},t),{},{startOffset:0,firstWaveformSample:0,numWaveformSamples:t.numSamples})]:[t])}),[]),selectedIndex:b});case n.SELECT_MIDI_INPUT:return pe(pe({},e),{},{midiSelectedInput:t.name});case n.SELECT_SOUND:return pe(pe({},e),{},{selectedIndex:t.index});case n.SET_MIDI_ACCESSIBLE:var D=t.value;return pe(pe({},e),{},{isMIDIAccessible:D});case n.SET_WAVEFORM_POSITION:var A=t.firstWaveformSample,R=e.pads,w=e.selectedIndex;return pe(pe({},e),{},{pads:R.reduce((function(e,t,n){return[].concat(ue()(e),n===w?[pe(pe({},t),{},{firstWaveformSample:A})]:[t])}),[])});case n.SET_WAVEFORM_ZOOM:var x=t.firstWaveformSample,C=t.numWaveformSamples,M=e.pads,P=e.selectedIndex;return pe(pe({},e),{},{pads:M.reduce((function(e,t,n){return[].concat(ue()(e),n===P?[pe(pe({},t),{},{firstWaveformSample:x,numWaveformSamples:C})]:[t])}),[])});case n.SET_PROJECT:var N=e.isMIDIAccessible,k=e.midiInputs,U=void 0===k?[]:k,G=e.midiOutputs,W=void 0===G?[]:G;return pe(pe(pe(pe({},he),e),t.state),{},{isMIDIAccessible:N,isRecordArmed:!1,isRecording:!1,midiInputs:U,midiOutputs:W});case n.SET_SAMPLE_START_OFFSET:var F=t.startOffset,j=e.pads,B=e.selectedIndex;return pe(pe({},e),{},{pads:j.reduce((function(e,t,n){return[].concat(ue()(e),n===B?[pe(pe({},t),{},{startOffset:F})]:[t])}),[])});case n.TOGGLE_RECORDING:var H=t.isRecording,q=t.index,J=H?q:-1;return pe(pe({},e),{},{isRecording:H,recordingIndex:J,selectedIndex:q,isCapturing:!1});case n.TOGGLE_RECORD_ARM:return pe(pe({},e),{},{isRecordArmed:!e.isRecordArmed});case n.TOGGLE_SETTINGS:var V=t.value;return pe(pe({},e),{},{isSettingsVisible:V});case n.UPDATE_MIDI_PORTS:var Z=t.portNames,z=t.portType,Y=e.midiInputs,$=void 0===Y?[]:Y,K=e.midiOutputs,Q=void 0===K?[]:K;return pe(pe({},e),{},{midiInputs:"input"===z?ue()(Z):$,midiOutputs:"output"===z?ue()(Z):Q});default:return e||he}}(me,e,ce);!function(e){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).type}(n,e,ce),me=n,document.dispatchEvent(new CustomEvent(ve,{detail:{state:n,action:e,actions:ce}}))}}function Ee(){return ce}function ye(){return me}function Se(){var e="persist";window.addEventListener("beforeunload",(function(t){localStorage.setItem(e,JSON.stringify(me))}));var t=localStorage.getItem(e);if(t&&"undefined"!==t){var n=JSON.parse(t);"object"===h()(n)&&ge(ce.setProject(n))}else ge(ce.newProject())}var Oe,Ie,_e,Te,be,Le,De,Ae,Re=88200,we=0;function xe(){return Oe&&Oe.getByteTimeDomainData(_e),{dataArray:_e,bufferLength:Ie}}function Ce(e){var t=e.detail,n=t.state,r=t.action,o=t.actions;switch(r.type){case o.SET_PROJECT:case o.TOGGLE_RECORD_ARM:!function(e){Ne.apply(this,arguments)}(n);break;case o.TOGGLE_RECORDING:!function(e){e.isRecording?(Le.port.postMessage("stopRecording"),be=0,Te=new Int16Array(Re),we=0,setTimeout((function(){Le.port.postMessage("startRecording")}),50)):Le.port.postMessage("stopRecording")}(n)}}function Me(){Te=new Int16Array(Re),document.addEventListener(ve,Ce)}function Pe(){if(Le)De.connect(Le);else{var e=O();e.audioWorklet.addModule("js/audio/recorder-worklet-processor.js").then((function(){(Le=new AudioWorkletNode(e,"recorder-worklet-processor")).port.onmessage=function(e){switch(e.data){case"startCapturing":ge(Ee().recordStart());break;default:!function(e){for(var t=Math.min(be+e.data.length,Re),n=0;be<t;be++,n++){var r=Math.max(-1,Math.min(e.data[n],1));Te[be]=r<0?32768*r:32767*r,Math.abs(r)<.2?we++:we=0}for(var o=new Uint8Array(Te.buffer),a="",i=0,c=o.byteLength;i<c;i++)a+=String.fromCharCode(o[i]);ge(Ee().recordAudioStream(a,be)),(be>=Re||we>=22050)&&ge(Ee().toggleRecording(!1))}(e)}},De.connect(Le)})).catch((function(e){console.log(e)}))}}function Ne(){return(Ne=f()(l().mark((function e(t){var n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.isRecordArmed,r=O(),!n){e.next=23;break}return e.prev=3,e.next=6,navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case 6:Ae=e.sent,(Oe=r.createAnalyser()).fftSize=2048,Ie=Oe.fftSize,_e=new Uint8Array(Ie),Oe.getByteTimeDomainData(_e),(De=r.createMediaStreamSource(Ae)).connect(Oe),Pe(),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(3),console.log("Record arm error: ",e.t0),ge(Ee().toggleRecordArm());case 21:e.next=25;break;case 23:De&&(De.disconnect(Oe),De.disconnect(Le),De=null),Ae&&Ae.getTracks().forEach((function(e){return e.stop()}));case 25:case"end":return e.stop()}}),e,null,[[3,17]])})))).apply(this,arguments)}var ke,Ue,Ge,We,Fe,je,Be,He="03b80e5a-ede8-4b33-a751-6ce34ec4c700";function qe(){return(qe=f()(l().mark((function e(){var t,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={filters:[{services:[He]}]},e.prev=1,console.log("requesting bluetooth device..."),e.next=5,navigator.bluetooth.requestDevice(t);case 5:if((ke=e.sent).addEventListener("gattserverdisconnected",(function(e){console.log("bluetooth device disconnected"),ge(Ee().bluetoothDisconnect())})),console.log("> bluetooth device found"),ke.gatt.connected){e.next=30;break}return console.log("> bluetooth device connecting..."),e.next=12,ke.gatt.connect();case 12:return Ue=e.sent,console.log("> bluetooth device connected"),e.next=16,Ue.getPrimaryService(He);case 16:return Ge=e.sent,console.log("> bluetooth service found"),e.next=20,Ge.getCharacteristics();case 20:if(n=e.sent,console.log("> bluetooth characteristics found: ",n.length),!(We=n[0]).properties.notify){e.next=30;break}return console.log("> bluetooth characteristic has notifications"),e.next=27,We.startNotifications();case 27:console.log("> bluetooth subscribed to notifications"),We.addEventListener("characteristicvaluechanged",Ve),ge(Ee().bluetoothSuccess());case 30:e.next=36;break;case 32:e.prev=32,e.t0=e.catch(1),console.log("bluetooth error: ",e.t0),ge(Ee().bluetoothError());case 36:case"end":return e.stop()}}),e,null,[[1,32]])})))).apply(this,arguments)}function Je(e){var t=e.detail,n=(t.state,t.action),r=t.actions;switch(n.type){case r.BLUETOOTH_CONNECT:!function(){qe.apply(this,arguments)}()}}function Ve(e){var t=e.target.value;switch(t.byteLength){case 5:ge(Ee().handleMIDIMessage(240&t.getUint8(2),15&t.getUint8(2),t.getUint8(3),t.getUint8(4)))}}function Ze(){document.addEventListener(ve,Je)}var ze,Ye=[],$e=-1,Ke=!1;function Qe(e){if(e.preventDefault(),clearTimeout(ze),document.removeEventListener("mouseup",Qe),document.removeEventListener("touchend",Qe),ge(Ee().toggleRecording(!1)),e.target.classList.contains("shape")){var t=ue()(e.target.parentElement.children).indexOf(e.target);ge(Ee().handleMIDIMessage(A,1,v[t],0))}}function Xe(e){e.preventDefault(),$e>-1&&je.item($e).classList.remove("shape--dragover"),$e=Array.from(e.target.parentNode.children).indexOf(e.target),je.item($e).classList.add("shape--dragover")}function et(e){e.preventDefault(),$e>-1&&je.item($e).classList.remove("shape--dragover"),$e=-1}function tt(e){e.preventDefault(),$e>-1&&(je.item($e).classList.remove("shape--dragover"),ge(Ee().loadAudioFile(e.dataTransfer.files,$e)))}function nt(e){console.log(e),e.preventDefault();var t=ue()(e.target.parentElement.children).indexOf(e.target);document.addEventListener("mouseup",Qe),document.addEventListener("touchend",Qe),ge(Ee().selectSound(t)),Ke?ze=setTimeout((function(){ge(Ee().toggleRecording(!0))}),50):ge(Ee().handleMIDIMessage(R,1,v[t],120))}function rt(e){var t=e.detail,n=t.state,r=t.action,o=t.actions;switch(r.type){case o.HANDLE_MIDI_MESSAGE:!function(e){var t=e.note,n=t.command,r=t.index;t.velocity,r>-1&&(n===R?je.item(r).classList.add("shape--play"):je.item(r).classList.remove("shape--play"))}(n),st(n);break;case o.RECORD_START:case o.TOGGLE_RECORDING:!function(e){var t=e.isCapturing,n=(e.pads,e.recordingIndex);e.selectedIndex,je.forEach((function(e,r){r===n&&t?je[n].innerHTML='\n        <div class="countdown">\n          <svg class="countdown__svg">\n            <circle r="24" cx="50%" cy="50%"></circle>\n          </svg>\n        </div>':je[r].innerHTML=""}))}(n),st(n);break;case o.TOGGLE_RECORD_ARM:ut(n);break;case o.NEW_PROJECT:case o.SET_PROJECT:st(n),ut(n);break;case o.RECORD_ERASE:case o.LOAD_AUDIOFILE:case o.RECORD_AUDIOSTREAM:case o.SELECT_SOUND:st(n)}}function ot(e){e.preventDefault(),Be.classList.add("waveform--dragover")}function at(e){e.preventDefault(),Be.classList.remove("waveform--dragover")}function it(e){e.preventDefault(),Be.classList.remove("waveform--dragover"),ge(Ee().loadAudioFile(e.dataTransfer.files))}function ct(){document.querySelector("#controls"),Fe=document.querySelector("#settings-btn"),je=document.querySelectorAll(".shape"),Be=document.querySelector("#waveform"),document.addEventListener(ve,rt),document.addEventListener("keydown",(function(e){if("input"!=e.target.tagName.toLowerCase()||"text"!=e.target.getAttribute("type"))switch(e.keyCode){case 82:case 83:case 84:Ye.push(e.keyCode),Ye.indexOf(82)>-1&&Ye.indexOf(83)>-1&&Ye.indexOf(84)>-1&&(console.log("Reset."),localStorage.clear(),ge(Ee().newProject()));break;case 87:console.log("state",ye());break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:ge(Ee().handleMIDIMessage(R,1,v[e.keyCode-49],120))}})),document.addEventListener("keyup",(function(e){if(Ye.length=0,"input"!=e.target.tagName.toLowerCase()||"text"!=e.target.getAttribute("type"))switch(e.keyCode){case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:ge(Ee().handleMIDIMessage(A,1,v[e.keyCode-49],0))}})),Fe.addEventListener("click",(function(e){ge(Ee().toggleSettings(!0))})),je.forEach((function(e){e.addEventListener("dragenter",Xe),e.addEventListener("dragover",Xe),e.addEventListener("dragleave",et),e.addEventListener("drop",tt),e.addEventListener("mousedown",nt),e.addEventListener("touchstart",nt)})),Be.addEventListener("dragenter",ot),Be.addEventListener("dragover",ot),Be.addEventListener("dragleave",at),Be.addEventListener("drop",it)}function st(e){var t=e.isCapturing,n=e.isRecording,r=e.pads,o=e.recordingIndex,a=e.selectedIndex;je.forEach((function(e,i){r[i]?(e.classList.add("shape--assigned"),i===a?e.classList.add("shape--selected"):e.classList.remove("shape--selected")):(e.classList.remove("shape--assigned"),e.classList.remove("shape--selected")),i===o&&n?t?e.classList.add("shape--capturing"):e.classList.add("shape--recording"):(e.classList.remove("shape--recording"),e.classList.remove("shape--capturing"))}))}function ut(e){Ke=e.isRecordArmed}var lt,dt=[];function ft(e){var t,n,r;dt.push(e),lt||(t=function(){dt.forEach((function(e){e()}))},250,lt=function(){var e=this,o=arguments,a=function(){r=null,t.apply(e,o)},i=n;clearTimeout(r),r=setTimeout(a,250),i&&t.apply(e,o)},window.addEventListener("resize",lt))}var pt,ht,vt,mt,gt,Et,yt,St,Ot,It,_t,Tt,bt=!1;function Lt(){var e=xe(),t=e.dataArray,n=e.bufferLength,r=ht.width/n,o=0;vt.fillRect(0,0,ht.width,ht.height),vt.beginPath();for(var a=0;a<n;a++){var i=t[a]/128*ht.height/2;0===a?vt.moveTo(o,i):vt.lineTo(o,i),o+=r}vt.lineTo(ht.width,ht.height/2),vt.stroke(),bt?requestAnimationFrame(Lt):vt.fillRect(0,0,ht.width,ht.height)}function Dt(e){var t=e.detail,n=t.state,r=t.action,o=t.actions;switch(r.type){case o.NEW_PROJECT:case o.SET_PROJECT:case o.TOGGLE_RECORD_ARM:!function(e){xt.apply(this,arguments)}(n)}}function At(){wt()}function Rt(){mt=document.querySelector("#controls__record-arm"),gt=document.querySelector("#controls__record-meter"),document.addEventListener(ve,Dt),mt.addEventListener("change",(function(e){ge(Ee().toggleRecordArm())})),ft(At)}function wt(){pt&&(pt.height=gt.clientHeight,pt.width=gt.clientWidth,ht=pt.getBoundingClientRect(),vt.fillStyle="#aaa",vt.lineWidth=4,vt.strokeStyle="#fff")}function xt(){return(xt=f()(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.isRecordArmed,bt=n,mt.checked=bt,bt&&(vt||(pt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),gt.appendChild(pt),vt=pt.getContext("2d"),wt()),Lt());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ct(e){var t=e.detail,n=t.state,r=t.action,o=t.actions;switch(r.type){case o.BLUETOOTH_CONNECT:It.textContent="Connecting...",Ot.setAttribute("disabled","disabled");break;case o.BLUETOOTH_DISCONNECT:It.textContent="Bluetooth disconnected.",Ot.removeAttribute("disabled");break;case o.BLUETOOTH_ERROR:It.textContent="Bluetooth error!",Ot.removeAttribute("disabled");break;case o.BLUETOOTH_SUCCESS:It.textContent="Bluetooth connected!";break;case o.SELECT_MIDI_INPUT:Pt(n);break;case o.SET_MIDI_ACCESSIBLE:!function(e){var t=e.isMIDIAccessible;Tt.textContent=t?"":"MIDI unavailable",t?_t.removeAttribute("disabled"):_t.setAttribute("disabled","disabled")}(n);break;case o.TOGGLE_SETTINGS:!function(e){e.isSettingsVisible?Et.dataset.show=!0:Et.dataset.show=!1}(n);break;case o.UPDATE_MIDI_PORTS:Pt(n)}}function Mt(){Et=document.querySelector("#settings"),yt=Et.querySelector(".dialog__layer"),St=Et.querySelector(".dialog__resolve"),_t=Et.querySelector(".midiin-select"),Tt=Et.querySelector(".midiin-status"),Ot=Et.querySelector(".ble-connect"),It=Et.querySelector(".ble-status"),document.addEventListener(ve,Ct),St.addEventListener("click",(function(e){ge(Ee().toggleSettings(!1))})),yt.addEventListener("click",(function(e){ge(Ee().toggleSettings(!1))})),_t.addEventListener("change",(function(e){ge(Ee().selectMIDIInput(e.target.value))})),Ot.addEventListener("click",(function(e){ge(Ee().bluetoothConnect())})),Et.querySelector(".btn-reset").addEventListener("click",(function(e){localStorage.clear(),ge(Ee().newProject())}))}function Pt(e){var t=e.midiInputs,n=e.midiSelectedInput;_t.querySelectorAll("option").forEach((function(e,t){t>0&&_t.removeChild(e)})),t.forEach((function(e){var t=document.createElement("option");t.value=e,t.textContent=e,_t.appendChild(t),e===n&&t.setAttribute("selected","selected")}))}var Nt,kt,Ut,Gt,Wt,Ft,jt,Bt,Ht,qt,Jt,Vt,Zt="#999",zt=function(e,t){return e+t},Yt=[];function $t(){Gt.clearRect(0,0,Ut.width,Ut.height)}function Kt(){if(Yt[qt])Gt.putImageData(Yt[qt],0,0);else{if(!Wt)return;Ft=kt.width,(jt=Ht/Ft)<Number.EPSILON?function(){for(var e=0,t=0,n=[],r=0;r<Ft;r++){var o=Bt+jt*r,a=Math.ceil(o),i=o+jt,c=Math.floor(i),s=[];if(o<a){var u=(a-o)/1,l=Wt[a]*(1-u)+Wt[a-1]*u;s.push(l)}if(i>c){var d=(i-c)/1,f=Wt[c]*(1-d)+Wt[c+1]*d;s.push(f)}if(a<=c)for(var p=a;p<=c;p++){var h=Wt[p];s.push(h)}var v=s.reduce(zt,0)/s.length;n.push(v),e=Math.max(v,e),t=Math.min(v,t)}var m=Math.max(e,-t),g=n.map((function(e){return e/m})),E=Ut.height/2;Gt.lineWidth=3,Gt.lineJoin="round",Gt.clearRect(0,0,Ut.width,Ut.height),Gt.save(),Gt.translate(0,E),Gt.strokeStyle=Zt,Gt.beginPath(),Gt.moveTo(0,0),g.forEach((function(e,t){Gt.lineTo(t,e*(E-10))})),Gt.stroke(),Gt.restore()}():function(){for(var e=[],t=[],n=0;n<Ft;n++){var r=Bt+jt*n,o=Math.ceil(r),a=r+jt,i=Math.floor(a),c=0,s=0;if(r<o){var u=(o-r)/1,l=Wt[o]*(1-u)+Wt[o-1]*u;c=Math.min(c,l),s=Math.max(s,l)}if(a>i){var d=(a-i)/1,f=Wt[i]*(1-d)+Wt[i+1]*d;c=Math.min(c,f),s=Math.max(s,f)}if(o<=i)for(var p=o;p<=i;p++){var h=Wt[p];c=Math.min(c,h),s=Math.max(s,h)}e.push(c),t.push(s)}var v=Ut.height/2;if(Gt.clearRect(0,0,Ut.width,Ut.height),Gt.lineWidth=3,Gt.lineJoin="round",Vt){var m=Math.ceil(Jt/88200*Ft);Gt.strokeStyle=Zt,Gt.moveTo(0,v),Gt.lineTo(Ft,v),Gt.stroke(),Gt.fillStyle="#333",Gt.fillRect(0,0,m,Ut.height),Gt.save(),Gt.translate(0,v),Gt.fillStyle="#fff",Gt.strokeStyle="#fff",Gt.beginPath(),Gt.moveTo(0,0);for(var g=0,E=m;g<E;g++)Gt.lineTo(g,t[g]*(v-10));for(var y=m-1;y>=0;y--)Gt.lineTo(y,e[y]*(v-10));Gt.fill(),Gt.stroke(),Gt.restore()}else{Gt.save(),Gt.translate(0,v),Gt.fillStyle="#eee",Gt.strokeStyle=Zt,Gt.beginPath(),Gt.moveTo(0,0),t.forEach((function(e,t){Gt.lineTo(t,e*(v-10))}));for(var S=e.length-1;S>=0;S--)Gt.lineTo(S,e[S]*(v-10));Gt.fill(),Gt.stroke(),Gt.restore()}}(),Yt[qt]=Gt.getImageData(0,0,Ut.width,Ut.height)}}function Qt(e){var t=e.detail,n=t.state,r=t.action,o=t.actions;switch(r.type){case o.AUDIOFILE_DECODED:case o.RECORD_ERASE:case o.TOGGLE_RECORDING:tn(n,!0);break;case o.NEW_PROJECT:case o.HANDLE_MIDI_MESSAGE:case o.RELOAD_AUDIOFILE_ON_SAME_PAD:case o.SELECT_SOUND:tn(n,!1);break;case o.SET_WAVEFORM_POSITION:case o.SET_WAVEFORM_ZOOM:!function(e){var t=e.pads[e.selectedIndex],n=t.firstWaveformSample,r=t.numWaveformSamples;Bt=n,Ht=r,Kt()}(n)}}function Xt(){kt.height=Nt.clientHeight,kt.width=Nt.clientWidth,Ut=kt.getBoundingClientRect(),Yt.length=0,Kt()}function en(){Nt=document.querySelector("#waveform"),kt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),Nt.appendChild(kt),kt.height=Nt.clientHeight,kt.width=Nt.clientWidth,Ut=kt.getBoundingClientRect(),Gt=kt.getContext("2d"),document.addEventListener(ve,Qt),ft(Xt)}function tn(e,t){Jt=e.captureBufferPosition,Vt=e.isCapturing;var n=e.pads,r=e.selectedIndex;if(n[r]){if(qt=r,t&&(Yt[qt]=null),!Yt[qt]){var o=n[r],a=o.firstWaveformSample,i=o.numWaveformSamples,c=y[s=r]?y[s].buffer:null;if(!c)return void $t();Bt=a,Ht=i,Wt=c.getChannelData(0)}var s;Kt()}else $t()}function nn(){return(nn=f()(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!1,e.prev=1,e.next=4,x();case 4:t=!0,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.log("Error",e.t0);case 10:return e.prev=10,T(),Me(),L(),Rt(),Mt(),ct(),en(),Se(),N(),Ze(),ge(Ee().setMidiAccessible(t)),ge(Ee().populate()),ge(Ee().toggleSettings(!0)),e.finish(10);case 25:case"end":return e.stop()}}),e,null,[[1,7,10,25]])})))).apply(this,arguments)}!function(){nn.apply(this,arguments)}()})()})();